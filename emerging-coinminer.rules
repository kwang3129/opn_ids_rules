#@opnsense_download_hash:b08260e38737cc46f9e2286ea469739d
# Emerging Threats Pro
#   http://www.emergingthreatspro.com
#
# This distribution may contain rules under three different licenses.
#
#  Rules with sids 1 through 3464, and 100000000 through 100000908 are under the GPLv2.
#  A copy of that license is available at http://www.gnu.org/licenses/gpl-2.0.html
#
#  Rules with sids 2000000 through 2799999 are from Emerging Threats and are covered under the BSD License
#  as follows:
#
#*************************************************************
#  Copyright (c) 2003-2025, Emerging Threats
#  All rights reserved.
#
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************
#
#
#  Rules with sids 2800000 through 2900000 are provided by Emerging Threats Pro and are covered by the license
#  provided in this distribution titled ETPRO-License.txt
#
#

# This Ruleset is EmergingThreats Pro optimized for suricata-5.0.

alert tcp $HOME_NET any -> $EXTERNAL_NET 8080: (msg:"ET COINMINER PrimeCoinMiner.Protominer"; flow:established,to_server; content:"|01 27 00 00 05 00 00 00 09|"; depth:9; content:"node"; nocase; within:4; content:"Protominer"; distance:14; within:10; reference:md5,4cab48eec2b882ec33db2e2a13ecffe6; classtype:coin-mining; sid:2018014; rev:2; metadata:attack_target Client_Endpoint, created_at 2014_01_27, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2020_08_19, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert dns $HOME_NET any -> any any (msg:"ETPRO COINMINER CoinMiner Mining Pool DNS Lookup"; dns.query; content:"miningpoolhub.com"; nocase; endswith; reference:md5,39897252ceb7040355d1dde248b56de0; classtype:coin-mining; sid:2829808; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, affected_product Mac_OSX, affected_product Linux, attack_target Client_Endpoint, created_at 2018_02_26, deployment Perimeter, malware_family CoinMiner, confidence High, signature_severity Major, tag Coinminer, updated_at 2024_04_19, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert dns $HOME_NET any -> any any (msg:"ET COINMINER CoinMiner Domain in DNS Lookup (pool .hashvault .pro)"; dns.query; content:"pool.hashvault.pro"; nocase; bsize:18; classtype:coin-mining; sid:2036289; rev:1; metadata:created_at 2022_04_21, performance_impact Significant, confidence High, signature_severity Major, updated_at 2022_04_21;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ET COINMINER Crypto Coin Miner Login"; flow:to_server,established; content:"|7b 22|method|22 3a|"; depth:10; fast_pattern; content:"|22|login|22 2c|"; within:9; content:"|22|params|22 3a|"; within:10; content:"|7b 22|login"; nocase; within:8; content:"agent|22 3a|"; nocase; distance:0; reference:md5,d1082e445f932938366a449631b82946; reference:md5,33d7a82fe13c9737a103bcc4a21f9425; reference:md5,ebe1aeb5dd692b222f8cf964e7785a55; classtype:coin-mining; sid:2022886; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2016_06_09, deployment Perimeter, malware_family CoinMiner, performance_impact Low, signature_severity Informational, tag Bitcoin_Miner, updated_at 2020_08_19;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ETPRO COINMINER XMR CoinMiner Usage"; flow:established,to_server; content:"|22|id|22 3a|"; content:"|22|method|22 3a|"; within:50; fast_pattern; content:"|22|params|22|"; within:30; content:"|22|agent|22|"; pcre:"/^[^\r|\n]+?(?:XMRig\/|WINREPORT\/|MinerGateWin32)/R"; threshold: type limit, count 1, seconds 600, track by_src; reference:md5,fd85ffcc823333130f8c27d19ff56a6a; classtype:coin-mining; sid:2826930; rev:5; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, affected_product Mac_OSX, affected_product Linux, attack_target Client_Endpoint, created_at 2017_06_28, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2022_10_10, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ETPRO COINMINER Win32/Delf.BBD Variant CnC Activity"; flow:established,to_server; content:">[info_client]|0d 0a 7b 22|Hash|22 3a 22|"; fast_pattern; content:"|22 2c 22|TotalMemory|22 3a 22|"; distance:32; within:17; reference:md5,6af41e9a285256f5487ac3cd4ac8526c; classtype:command-and-control; sid:2839724; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_12_03, deployment Perimeter, performance_impact Low, confidence High, signature_severity Major, updated_at 2020_02_21;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 3333 (msg:"ETPRO COINMINER RiskTool.BitCoinMiner.frk Checkin"; flow:to_server,established; dsize:<200; content:"|7b 22|id|22 3a|"; depth:6; content:"|2c 20 22|method|22 3a 20 22|"; fast_pattern; distance:0; content:"|22 2c 20 22|params|22 3a 20 5b 22|"; distance:0; reference:md5,9e5a49d5cdfc1dd19e1137574f8a1237; reference:md5,c9f23417a8b3ffe19aa5a316e68652b9; classtype:coin-mining; sid:2807094; rev:2; metadata:attack_target Client_Endpoint, created_at 2013_10_08, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2019_07_26, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"ET COINMINER Observed Coin-Hive In Browser Mining Domain (coin-hive .com in TLS SNI)"; flow:established,to_server; tls.sni; content:"coin-hive.com"; endswith; classtype:trojan-activity; sid:2025535; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2018_04_26, deployment Perimeter, malware_family CoinMiner, performance_impact Moderate, confidence High, signature_severity Minor, updated_at 2020_09_16;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET COINMINER W32/BitCoinMiner.MultiThreat Stratum Protocol Mining.Notify Work Server Response"; flow:established,to_client; content:"|22|params|22 3A| [|22|"; depth:120; content:"|22|method|22 3A| |22|mining.notify|22|"; distance:0; reference:url,research.zscaler.com/2013/12/bitcoin-mining-operation-seen-across.html; reference:url,www.btcguild.com/new_protocol.php; reference:url,mining.bitcoin.cz/stratum-mining; classtype:coin-mining; sid:2017873; rev:3; metadata:attack_target Client_Endpoint, created_at 2013_12_17, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2019_07_26, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET COINMINER W32/BitCoinMiner.MultiThreat Stratum Protocol Mining.Notify Initial Connection Server Response"; flow:established,to_client; content:"|22|result|22 3A| [[|22|mining.notify|22|"; depth:120; reference:url,research.zscaler.com/2013/12/bitcoin-mining-operation-seen-across.html; reference:url,www.btcguild.com/new_protocol.php; reference:url,mining.bitcoin.cz/stratum-mining; classtype:coin-mining; sid:2017872; rev:2; metadata:attack_target Client_Endpoint, created_at 2013_12_17, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2019_07_26, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ET COINMINER W32/BitCoinMiner.MultiThreat Subscribe/Authorize Stratum Protocol Message"; flow:established,to_server; content:!"EHLO"; startswith; content:"|22|id|22 3A|"; content:"|22|method|22 3A|"; content:"|22|mining."; within:9; content:"|22|params|22|"; within:50; pcre:"/\x22mining\x2E(subscribe|authorize)\x22/"; reference:url,research.zscaler.com/2013/12/bitcoin-mining-operation-seen-across.html; reference:url,www.btcguild.com/new_protocol.php; reference:url,mining.bitcoin.cz/stratum-mining; classtype:coin-mining; sid:2017871; rev:8; metadata:attack_target Client_Endpoint, created_at 2013_12_17, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2023_01_24, reviewed_at 2024_04_19, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET COINMINER Bitcoin Mining Extensions Header"; flow:to_server,established; http.method; content:"POST"; http.header; content:"X-Mining-Extensions|3a|"; classtype:coin-mining; sid:2016758; rev:5; metadata:created_at 2013_04_16, signature_severity Minor, updated_at 2020_04_23;)
alert dns $HOME_NET any -> any any (msg:"ET COINMINER Observed DNS Query to herominers Domain (herominers .com)"; dns.query; content:".herominers.com"; nocase; endswith; fast_pattern; classtype:coin-mining; sid:2033901; rev:2; metadata:attack_target Client_Endpoint, created_at 2021_09_03, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2021_09_03, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET COINMINER CoinMiner Exfiltration via IRC Config Inbound (Italian)"; flow:established,to_client; http.response_body; content:"|2f 2f 20|Configurazione|20|del|20|bot|20|IRC"; fast_pattern; content:"|2f 2f 20|Sostituisci|20|con|20|l|27|indirizzo|20|del|20|server|20|IRC"; distance:0; content:"|2f 2f 20|Username|20|del|20|bot"; distance:0; content:"|2f 2f 20|Realname|20|del|20|bot"; reference:md5,8524f6f843902e2d19f29a578f76adf6; classtype:trojan-activity; sid:2059794; rev:1; metadata:attack_target Client_Endpoint, tls_state plaintext, created_at 2025_01_31, deployment Perimeter, confidence High, signature_severity Major, tag Coinminer, updated_at 2025_01_31, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking; target:dest_ip;)
alert dns $HOME_NET any -> any any (msg:"ET COINMINER Observed DNS Query to Monero Miner Related Domain (monerohash .com)"; dns.query; bsize:14; content:"monerohash.com"; nocase; reference:url,asec.ahnlab.com/en/54647/; classtype:coin-mining; sid:2048922; rev:1; metadata:attack_target Client_Endpoint, created_at 2023_10_27, deployment Perimeter, performance_impact Low, confidence High, signature_severity Informational, updated_at 2023_10_27, reviewed_at 2023_10_27; target:src_ip;)
alert dns $HOME_NET any -> any any (msg:"ET COINMINER Observed DNS Query to Browser Coinminer (crypto-loot[.]com)"; dns.query; content:"crypto-loot.com"; endswith; classtype:coin-mining; sid:2024828; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2017_10_09, deployment Perimeter, malware_family CoinMiner, confidence High, signature_severity Major, tag Coinminer, updated_at 2020_09_15, mitre_tactic_id TA0040, mitre_tactic_name Impact, mitre_technique_id T1496, mitre_technique_name Resource_Hijacking;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ETPRO COINMINER Observed Litecoin Activity"; flow:established,to_server; dsize:<250; content:"version"; offset:4; depth:7; content:"|2f|Satoshi|3a|"; distance:0; fast_pattern; content:"|2f 00 00 00 00|"; distance:0; isdataat:!1,relative; classtype:coin-mining; sid:2844924; rev:3; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2020_10_14, deployment Perimeter, confidence High, signature_severity Informational, updated_at 2023_06_30;)
alert dns $HOME_NET any -> any any (msg:"ET COINMINER Observed DNS Query to Cryptocurrency Mining Pool Domain (xmr .2miners .com)"; dns.query; content:"xmr.2miners.com"; nocase; bsize:15; classtype:coin-mining; sid:2040353; rev:3; metadata:created_at 2022_11_29, performance_impact Low, confidence High, signature_severity Informational, updated_at 2023_04_26, reviewed_at 2025_07_14;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET COINMINER CoinHive In-Browser Miner Detected"; flow:established,from_server; file_data; content:"coinhive.min.js"; nocase; fast_pattern; content:"start"; nocase; distance:0; content:"script"; content:"var"; distance:0; pcre:"/^\s*(?P<var>[a-zA-Z0-9]{3,20})\s*=\s*new\s*CoinHive\s*\.\s*[^\(]+\(\s*[\x22\x27][A-Za-z0-9]+\s*[\x22\x27]\s*(?:\x2c\s*\x7b\s*\w+\x3a\s*\d\.\d\x7d)?\)\s*\x3b\s+(?P=var)\s*\.\s*start/Ri"; classtype:coin-mining; sid:2024721; rev:2; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2017_09_18, deployment Perimeter, performance_impact Moderate, confidence High, signature_severity Major, updated_at 2019_07_26;)